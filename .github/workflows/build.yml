name: Build fuckfile

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-linux-x64:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Build Linux x86_64
        run: |
          gcc -o fuckfile-linux-x64 main.c -O2 -static
          strip fuckfile-linux-x64
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: fuckfile-linux-x64
          path: fuckfile-linux-x64

  build-linux-x86:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Install 32-bit libraries
        run: |
          sudo dpkg --add-architecture i386
          sudo apt-get update
          sudo apt-get install -y gcc-multilib g++-multilib libc6-dev-i386
      
      - name: Build Linux i686
        run: |
          gcc -m32 -o fuckfile-linux-x86 main.c -O2 -static
          strip fuckfile-linux-x86
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: fuckfile-linux-x86
          path: fuckfile-linux-x86

  build-linux-arm64:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      
      - name: Install ARM64 cross-compiler
        run: |
          sudo apt-get update
          sudo apt-get install -y gcc-aarch64-linux-gnu binutils-aarch64-linux-gnu
      
      - name: Build Linux ARM64
        run: |
          aarch64-linux-gnu-gcc -o fuckfile-linux-arm64 main.c -O2 -static
          aarch64-linux-gnu-strip fuckfile-linux-arm64
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: fuckfile-linux-arm64
          path: fuckfile-linux-arm64

  build-linux-armv7:
    runs-on: ubuntu-22.04
    steps:
      - uses: actions/checkout@v4
      
      - name: Install ARMv7 cross-compiler
        run: |
          sudo apt-get update
          sudo apt-get install -y gcc-arm-linux-gnueabihf binutils-arm-linux-gnueabihf
      
      - name: Build Linux ARMv7
        run: |
          arm-linux-gnueabihf-gcc -o fuckfile-linux-armv7 main.c -O2 -static
          arm-linux-gnueabihf-strip fuckfile-linux-armv7
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: fuckfile-linux-armv7
          path: fuckfile-linux-armv7

  build-windows-x64:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup MSVC
        uses: ilammy/msvc-dev-cmd@v1
        with:
          arch: x64
      
      - name: Build Windows x64
        run: |
          cl /O2 main.c /Fe:fuckfile-windows-x64.exe
        shell: cmd
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: fuckfile-windows-x64
          path: fuckfile-windows-x64.exe

  build-windows-x86:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup MSYS2
        uses: msys2/setup-msys2@v2
        with:
          msystem: MINGW32
          update: true
          install: mingw-w64-i686-gcc
      
      - name: Build Windows x86
        shell: msys2 {0}
        run: |
          gcc -o fuckfile-windows-x86.exe main.c -O2 -static
          strip fuckfile-windows-x86.exe
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: fuckfile-windows-x86
          path: fuckfile-windows-x86.exe

  build-windows-arm64:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup MSVC ARM64
        uses: ilammy/msvc-dev-cmd@v1
        with:
          arch: amd64_arm64
      
      - name: Build Windows ARM64
        run: |
          cl /O2 main.c /Fe:fuckfile-windows-arm64.exe
        shell: cmd
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: fuckfile-windows-arm64
          path: fuckfile-windows-arm64.exe

  build-android:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        include:
          - arch: arm64-v8a
            abi: aarch64-linux-android
            api: 21
            output: fuckfile-android-arm64
          - arch: armeabi-v7a
            abi: armv7a-linux-androideabi
            api: 21
            output: fuckfile-android-armv7
          - arch: x86_64
            abi: x86_64-linux-android
            api: 21
            output: fuckfile-android-x86_64
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Android NDK
        uses: nttld/setup-ndk@v1
        with:
          ndk-version: r26c
          add-to-path: true
      
      - name: Build Android
        run: |
          $ANDROID_NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64/bin/${{ matrix.abi }}${{ matrix.api }}-clang \
            -o ${{ matrix.output }} main.c -O2 -static
          $ANDROID_NDK_HOME/toolchains/llvm/prebuilt/linux-x86_64/bin/llvm-strip ${{ matrix.output }}
      
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: ${{ matrix.output }}
          path: ${{ matrix.output }}